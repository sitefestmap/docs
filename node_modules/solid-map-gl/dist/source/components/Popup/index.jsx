import { onCleanup, createEffect, splitProps } from 'solid-js';
import { useMapContext } from '../MapProvider';
export const Popup = (props) => {
    if (!props.trackPointer && !props.lngLat)
        throw new Error('Popup - lngLat or trackPointer is required');
    const [update, create] = splitProps(props, [
        'lngLat',
        'children',
        'trackPointer',
    ]);
    const [ctx] = useMapContext();
    let popup;
    // Update Popup
    createEffect(() => {
        if (!ctx.map)
            return;
        popup?.remove();
        popup = new window.MAPLIB.Popup({
            closeOnClick: false,
            focusAfterOpen: false,
            ...create.options,
        })
            .on('open', () => create.onOpen?.())
            .on('close', () => create.onClose?.())
            .addTo(ctx.map);
        // Update Position
        createEffect(() => update.trackPointer
            ? popup.trackPointer()
            : popup.setLngLat(update.lngLat));
        // Update Content
        createEffect(() => typeof update.children === 'string'
            ? popup.setHTML(update.children)
            : popup.setDOMContent(update.children));
    });
    // Remove Popup
    onCleanup(() => popup?.remove());
    return null;
};
