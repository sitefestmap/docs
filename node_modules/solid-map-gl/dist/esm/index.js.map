{"version":3,"file":"index.js","sources":["../../src/components/MapProvider/index.tsx","../../src/events.ts","../../src/mapStyles.ts","../../src/components/MapGL/index.tsx","../../src/components/Source/index.tsx","../../src/styles.ts","../../src/components/Layer/index.tsx","../../src/components/Layer3D/index.tsx","../../src/components/Atmosphere/index.tsx","../../src/components/Terrain/index.tsx","../../src/components/Control/index.tsx","../../src/components/Marker/index.tsx","../../src/components/Popup/index.tsx","../../src/components/Image/index.tsx","../../src/components/Camera/index.tsx","../../src/components/Light/index.tsx","../../src/components/Draw/index.tsx"],"sourcesContent":["import { createContext, useContext, ParentComponent } from 'solid-js'\nimport { createStore } from 'solid-js/store'\nimport type { Map } from '../MapGL'\n\nconst [state, setState] = createStore({ map: null })\n\nexport const MapContext = createContext([state])\n\nexport const useMapContext = () => useContext(MapContext)\n\nexport const MapProvider: ParentComponent<{\n  map?: Map\n}> = (props) => {\n  props.map && setState('map', props.map)\n\n  return (\n    <MapContext.Provider value={[state]}>{props.children}</MapContext.Provider>\n  )\n}\n","import type {\n  MapMouseEvent,\n  MapTouchEvent,\n  MapWheelEvent,\n  MapDataEvent,\n  MapBoxZoomEvent,\n} from 'mapbox-gl'\n\ntype mapEventTypes = {\n  onMouseDown?: (event: MapMouseEvent) => void\n  onMouseUp?: (event: MapMouseEvent) => void\n  onMouseOver?: (event: MapMouseEvent) => void\n  onMouseOut?: (event: MapMouseEvent) => void\n  onMouseMove?: (event: MapMouseEvent) => void\n  onMouseEnter?: (event: MapMouseEvent) => void\n  onMouseLeave?: (event: MapMouseEvent) => void\n  onPreClick?: (event: MapMouseEvent) => void\n  onClick?: (event: MapMouseEvent) => void\n  onDblClick?: (event: MapMouseEvent) => void\n  onContextMenu?: (event: MapMouseEvent) => void\n  onTouchStart?: (event: MapTouchEvent) => void\n  onTouchEnd?: (event: MapTouchEvent) => void\n  onTouchCancel?: (event: MapTouchEvent) => void\n  onTouchMove?: (event: MapTouchEvent) => void\n  onWheel?: (event: MapWheelEvent) => void\n  onResize?: () => void\n  onRemove?: () => void\n  onMoveStart?: (event: DragEvent) => void\n  onMove?: (event: MapMouseEvent | MapTouchEvent) => void\n  onMoveEnd?: (event: DragEvent) => void\n  onDragStart?: (event: DragEvent) => void\n  onDrag?: (event: MapMouseEvent | MapTouchEvent) => void\n  onDragEnd?: (event: DragEvent) => void\n  onZoomStart?: (event: MapMouseEvent | MapTouchEvent) => void\n  onZoom?: (event: MapMouseEvent | MapTouchEvent) => void\n  onZoomEnd?: (event: MapMouseEvent | MapTouchEvent) => void\n  onRotateStart?: (event: MapMouseEvent | MapTouchEvent) => void\n  onRotate?: (event: MapMouseEvent | MapTouchEvent) => void\n  onRotatEnd?: (event: MapMouseEvent | MapTouchEvent) => void\n  onPitchStart?: (event: MapDataEvent) => void\n  onPitch?: (event: MapDataEvent) => void\n  onPitchEnd?: (event: MapDataEvent) => void\n  onBoxZoomStart?: (event: MapBoxZoomEvent) => void\n  onBoxZoomEnd?: (event: MapBoxZoomEvent) => void\n  onBoxZoomCancel?: (event: MapBoxZoomEvent) => void\n  onWebglContextLost?: () => void\n  onWebglContextRestored?: () => void\n  onLoad?: (event: any) => void\n  onRender?: () => void\n  onIdle?: () => void\n  onError?: (error: string) => void\n  onData?: (event: MapDataEvent) => void\n  onStyleData?: (event: MapDataEvent) => void\n  onSourceData?: (event: MapDataEvent) => void\n  onDataLoading?: (event: MapDataEvent) => void\n  onStyleDataLoading?: (event: MapDataEvent) => void\n  onSourceDataLoading?: (event: MapDataEvent) => void\n  onStyleImageMissing?: (event: MapDataEvent) => void\n}\n\nconst mapEvents: string[] = [\n  'onMouseDown',\n  'onMouseUp',\n  'onMouseOver',\n  'onMouseOut',\n  'onMouseMove',\n  'onMouseEnter',\n  'onMouseLeave',\n  'onPreClick',\n  'onClick',\n  'onDblClick',\n  'onContextMenu',\n  'onTouchStart',\n  'onTouchEnd',\n  'onTouchCancel',\n  'onWheel',\n  'onResize',\n  'onRemove',\n  'onTouchMove',\n  'onMoveStart',\n  'onMove',\n  'onMoveEnd',\n  'onDragStart',\n  'onDrag',\n  'onDragEnd',\n  'onZoomStart',\n  'onZoom',\n  'onZoomEnd',\n  'onRotateStart',\n  'onRotate',\n  'onRotatEnd',\n  'onPitchStart',\n  'onPitch',\n  'onPitchEnd',\n  'onBoxZoomStart',\n  'onBoxZoomEnd',\n  'onBoxZoomCancel',\n  'onWebglContextLost',\n  'onWebglContextRestored',\n  'onLoad',\n  'onRender',\n  'onIdle',\n  'onError',\n  'onData',\n  'onStyleData',\n  'onSourceData',\n  'onDataLoading',\n  'onStyleDataLoading',\n  'onSourceDataLoading',\n  'onStyleImageMissing',\n]\n\ntype layerEventTypes = {\n  onMouseDown?: (event: MapMouseEvent) => void\n  /** called when the mouse button is pressed down on the layer */\n  onMouseUp?: (event: MapMouseEvent) => void\n  /** called when the mouse button is released after a mouse down event on the layer */\n  onMouseOver?: (event: MapMouseEvent) => void\n  /** called when the mouse enters the layer */\n  onMouseOut?: (event: MapMouseEvent) => void\n  /** called when the mouse leaves the layer */\n  onMouseMove?: (event: MapMouseEvent) => void\n  /** called when the mouse is moved over the layer */\n  onMouseEnter?: (event: MapMouseEvent) => void\n  /** called when the mouse enters the layer */\n  onMouseLeave?: (event: MapMouseEvent) => void\n  /** called when the mouse leaves the layer */\n  onClick?: (event: MapMouseEvent) => void\n  /** called when the layer is clicked */\n  onDblClick?: (event: MapMouseEvent) => void\n  /** called when the layer is double-clicked */\n  onContextMenu?: (event: MapMouseEvent) => void\n  /** called when the context menu is triggered on the layer */\n  onTouchStart?: (event: MapTouchEvent) => void\n  /** called when a touch event is started on the layer */\n  onTouchEnd?: (event: MapTouchEvent) => void\n  /** called when a touch event is ended on the layer */\n  onTouchCancel?: (event: MapTouchEvent) => void\n  /** called when a touch event is cancelled on the layer */\n}\n\nconst layerEvents: any[] = [\n  'onMouseDown',\n  'onMouseUp',\n  'onMouseOver',\n  'onMouseOut',\n  'onMouseMove',\n  'onMouseEnter',\n  'onMouseLeave',\n  'onClick',\n  'onDblClick',\n  'onContextMenu',\n  'onTouchStart',\n  'onTouchEnd',\n  'onTouchCancel',\n]\n\nconst drawEvents: any[] = [\n  'onCreate',\n  'onDelete',\n  'onCombine',\n  'onUncombine',\n  'onUpdate',\n  'onSelectionchange',\n  'onModechange',\n  'onRender',\n  'onActionable',\n]\n\ntype drawEventTypes = {\n  onCreate?: (event: Object) => void\n  /** called when a feature is created */\n  onDelete?: (event: Object) => void\n  /** called when a feature is deleted */\n  onCombine?: (event: Object) => void\n  /** called when features are combined */\n  onUncombine?: (event: Object) => void\n  /** called when features are uncombined */\n  onUpdate?: (event: Object) => void\n  /** called when a feature is updated */\n  onSelectionchange?: (event: Object) => void\n  /** called when the selected features change */\n  onModechange?: (event: Object) => void\n  /** called when the draw mode changes */\n  onRender?: (event: Object) => void\n  /** called when the draw canvas is re-rendered */\n  onActionable?: (event: Object) => void\n  /** called when the state of the draw controls changes */\n}\n\nexport { mapEvents, layerEvents, drawEvents }\nexport type { mapEventTypes, layerEventTypes, drawEventTypes }\n","const mapBase = 'mapbox://styles/mapbox'\nconst gitBase = 'https://raw.githubusercontent.com/'\nconst gishub = 'https://raw.githubusercontent.com/GIShub4/map-styles/main/'\nconst hereBase = 'https://assets.vector.hereapi.com/styles/'\n\nexport const vectorStyleList: object = {\n  mb: {\n    standard: `${mapBase}/standard`,\n    light: `${mapBase}/light-v11`,\n    dark: `${mapBase}/dark-v11`,\n    street: `${mapBase}/streets-v12`,\n    outdoor: `${mapBase}/outdoors-v12`,\n    sat: `${mapBase}/satellite-v9`,\n    sat_street: `${mapBase}/satellite-streets-v12`,\n    nav_base: `${mapBase}/navigation-guidance-day-v4`,\n    nav_base_night: `${mapBase}/navigation-guidance-night-v4`,\n    nav: `${mapBase}/navigation-day-v1`,\n    nav_night: `${mapBase}/navigation-night-v1`,\n    basic: `${mapBase}/cjf4m44iw0uza2spb3q0a7s41`,\n    monochrome: `${mapBase}/cjv6rzz4j3m4b1fqcchuxclhb`,\n    leshine: `${mapBase}/cjcunv5ae262f2sm9tfwg8i0w`,\n    icecream: `${mapBase}/cj7t3i5yj0unt2rmt3y4b5e32`,\n    cali: `${mapBase}/cjerxnqt3cgvp2rmyuxbeqme7`,\n    northstar: `${mapBase}/cj44mfrt20f082snokim4ungi`,\n    mineral: `${mapBase}/cjtep62gq54l21frr1whf27ak`,\n    moonlight: `${mapBase}/cj3kbeqzo00022smj7akz3o1e`,\n    frank: `${mapBase}-map-design/ckshxkppe0gge18nz20i0nrwq`,\n    minimo: `${mapBase}-map-design/cksjc2nsq1bg117pnekb655h1`,\n    decimal: `${mapBase}-map-design/ck4014y110wt61ctt07egsel6`,\n    stand: `${mapBase}-map-design/ckr0svm3922ki18qntevm857n`,\n    blueprint: `${mapBase}-map-design/cks97e1e37nsd17nzg7p0308g`,\n    bubble: `${mapBase}-map-design/cksysy2nl62zp17quosctdtcc`,\n    pencil: `${mapBase}-map-design/cks9iema71es417mlrft4go2k`,\n    swiss_ski: `${gitBase}mapbox/mapbox-gl-swiss-ski-style/master/cij1zoclj002y8rkkdjl69psd.json`,\n    vintage: `${gitBase}mapbox/mapbox-gl-vintage-style/master/cif5p01n202nisaktvljx9mv3.json`,\n    whaam: `${gitBase}mapbox/mapbox-gl-whaam-style/master/cii8323c8004w0nlvtss3dbm2.json`,\n    neon: `${gitBase}NatEvatt/awesome-mapbox-gl-styles/master/styles/Neon/style.json`,\n    camoflauge: `${gitBase}jingsam/mapbox-gl-styles/master/Camouflage.json`,\n    emerald: `${gitBase}jingsam/mapbox-gl-styles/master/Emerald.json`,\n    runner: `${gitBase}jingsam/mapbox-gl-styles/master/Runner.json`,\n    x_ray: `${gitBase}jingsam/mapbox-gl-styles/master/X-ray.json`,\n  },\n  here: {\n    base: `${hereBase}berlin/base/mapbox/tilezen?apikey={apikey}`,\n    day: `${hereBase}berlin/day/mapbox/tilezen?apikey={apikey}`,\n    night: `${hereBase}berlin/night/mapbox/tilezen?apikey={apikey}`,\n  },\n  esri: {\n    blueprint: `${gishub}esri:blueprint.json`,\n    charted_territory: `${gishub}esri:charted-territory.json`,\n    colored_pencil: `${gishub}esri:colored-pencil.json`,\n    community: `${gishub}esri:community.json`,\n    mid_century: `${gishub}esri:mid-century.json`,\n    modern_antique: `${gishub}esri:modern-antique.json`,\n    nat_geo: `${gishub}esri:national-geographic.json`,\n    newspaper: `${gishub}esri:newspaper.json`,\n    open_street_map: `${gishub}esri:open-street-map.json`,\n    light_gray_canvas: `${gishub}esri:light-gray-canvas.json`,\n    dark_gray_canvas: `${gishub}esri:dark-gray-canvas.json`,\n    human_geo_light: `${gishub}esri:human-geography-light.json`,\n    human_geo_dark: `${gishub}esri:human-geography-dark.json`,\n    world_navigation: `${gishub}esri:world-navigation.json`,\n    world_street: `${gishub}esri:world-street.json`,\n    world_street_night: `${gishub}esri:world-street-night.json`,\n    world_terrain: `${gishub}esri:world-terrain.json`,\n    world_terrain_hybrid: `${gishub}esri:world-terrain-hybrid.json`,\n    world_topographic: `${gishub}esri:world-topographic.json`,\n    chromium: `${gishub}esri:chromium.json`,\n    dreamcatcher: `${gishub}esri:dreamcatcher.json`,\n    seahaven: `${gishub}esri:seahaven.json`,\n    sangria: `${gishub}esri:sangria.json`,\n    mercurial: `${gishub}esri:mercurial.json`,\n    imagery: `${gishub}esri:imagery.json`,\n    imagery_hybrid: `${gishub}esri:imagery-hybrid.json`,\n    firefly: `${gishub}esri:firefly.json`,\n    firefly_hybrid: `${gishub}esri:firefly-hybrid.json`,\n    oceans: `${gishub}esri:oceans.json`,\n  },\n}\nconst carto = 'https://{s}.basemaps.cartocdn.com/rastertiles/'\nconst stamen = 'https://stamen-tiles-{s}.a.ssl.fastly.net/'\nconst tf = 'https://{s}.tile.thunderforest.com/'\n\nexport const rasterStyleList: object = {\n  osm: {\n    org: 'https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',\n    human: 'https://{s}.tile.openstreetmap.fr/hot/{z}/{x}/{y}.png',\n    cycle: 'https://{s}.tile-cyclosm.openstreetmap.fr/cyclosm/{z}/{x}/{y}.png',\n    topo: 'https://{s}.tile.opentopomap.org/{z}/{x}/{y}.png',\n    _copy:\n      '<a href=\"https://www.openstreetmap.org/copyright\" target=\"_blank\">&copy; OpenStreetMap</a>',\n  },\n  carto: {\n    voyager: `${carto}voyager_labels_under/{z}/{x}/{y}{r}.png`,\n    positron: `${carto}light_all/{z}/{x}/{y}{r}.png`,\n    dark: `${carto}dark_all/{z}/{x}/{y}{r}.png`,\n    _copy:\n      '<a href=\"https://carto.com/attribution\" target=\"_blank\">&copy; Carto</a>',\n  },\n  stamen: {\n    toner: `${stamen}toner/{z}/{x}/{y}{r}.png`,\n    toner_lite: `${stamen}toner-lite/{z}/{x}/{y}{r}.png`,\n    watercolor: `${stamen}watercolor/{z}/{x}/{y}.png`,\n    terrain: `${stamen}terrain/{z}/{x}/{y}{r}.png`,\n    _copy:\n      '<a href=\"https://stamen.com/privacy-policy\" target=\"_blank\">&copy; Stamen Design</a>',\n  },\n  tf: {\n    cycle: `${tf}cycle/{z}/{x}/{y}{r}.png?apikey={apikey}`,\n    trans: `${tf}transport/{z}/{x}/{y}{r}.png?apikey={apikey}`,\n    trans_dark: `${tf}transport-dark/{z}/{x}/{y}{r}.png?apikey={apikey}`,\n    landscape: `${tf}landscape/{z}/{x}/{y}{r}.png?apikey={apikey}`,\n    outdoors: `${tf}outdoors/{z}/{x}/{y}{r}.png?apikey={apikey}`,\n    neighbourhood: `${tf}neighbourhood/{z}/{x}/{y}{r}.png?apikey={apikey}`,\n    spinal: `${tf}spinal-map/{z}/{x}/{y}{r}.png?apikey={apikey}`,\n    pioneer: `${tf}pioneer/{z}/{x}/{y}{r}.png?apikey={apikey}`,\n    atlas: `${tf}atlas/{z}/{x}/{y}{r}.png?apikey={apikey}`,\n    mobile: `${tf}mobile-atlas/{z}/{x}/{y}{r}.png?apikey={apikey}`,\n    _copy:\n      '<a href=\"https://thunderforest.com/privacy\" target=\"_blank\">&copy; Thunderforest</a>',\n  },\n}\n","import {\n  createSignal,\n  createEffect,\n  onMount,\n  onCleanup,\n  Component,\n  on,\n} from \"solid-js\";\nimport { MapProvider } from \"../MapProvider\";\nimport { mapEvents } from \"../../events\";\nimport { vectorStyleList } from \"../../mapStyles\";\nimport type { mapEventTypes } from \"../../events\";\nimport type mapboxgl from \"mapbox-gl\";\nimport type { MapboxOptions } from \"mapbox-gl/src/ui/map\";\nimport type { LngLatLike } from \"mapbox-gl/src/geo/lng_lat.js\";\nimport type { LngLatBounds } from \"mapbox-gl/src/geo/lng_lat_bounds.js\";\nimport type { PaddingOptions } from \"mapbox-gl/src/geo/edge_insets.js\";\nimport type { StyleSpecification } from \"mapbox-gl/src/style-spec/types.js\";\nimport type { JSX } from \"solid-js\";\n\ndeclare global {\n  interface Window {\n    MapLib?: any;\n  }\n}\n\nexport type Map = mapboxgl.Map & {\n  debug: boolean;\n  debugEvents: boolean;\n  sourceIdList: string[];\n  layerIdList: string[];\n};\n\nexport type Viewport = {\n  id?: string;\n  point?: { x: number; y: number };\n  center?: LngLatLike;\n  bounds?: LngLatBounds;\n  zoom?: number;\n  pitch?: number;\n  bearing?: number;\n  padding?: PaddingOptions;\n  inTransit?: boolean;\n};\n\ntype Props = {\n  /** ID for the map container element */\n  id?: string;\n  /** Map Container CSS Style */\n  style?: JSX.CSSProperties;\n  /** Map Container CSS Class */\n  class?: string;\n  /** SolidJS Class List for Map Container */\n  classList?: {\n    [k: string]: boolean | undefined;\n  };\n  /** Current Map View */\n  viewport?: Viewport;\n  /** Mapbox Options\n   * @see https://docs.mapbox.com/mapbox-gl-js/api/map/#map-parameters\n   */\n  options?: MapboxOptions;\n  /** Mapbox Style Configuration\n   * @see https://docs.mapbox.com/mapbox-gl-js/guides/styles/#configure-a-style\n   */\n  config?: {\n    id?: string;\n    lightPreset?: \"dawn\" | \"day\" | \"dusk\" | \"night\" | string;\n    showPlaceLabels?: boolean;\n    showRoadLabels?: boolean;\n    showPointOfInterestLabels?: boolean;\n    showTransitLabels?: boolean;\n    font?: string[];\n    [key: string]: boolean | string | string[];\n  };\n  /** Type for pan, move and zoom transitions */\n  transitionType?: \"flyTo\" | \"easeTo\" | \"jumpTo\" | string;\n  /** Event listener for Viewport updates */\n  onViewportChange?: (viewport: Viewport) => void;\n  /** Event listener for User Interaction */\n  onUserInteraction?: (user: boolean) => void;\n  /** Displays Map Tile Borders */\n  showTileBoundaries?: boolean;\n  /** Displays Wireframe if Terrain is visible */\n  showTerrainWireframe?: boolean;\n  /** Displays Borders if Padding is set */\n  showPadding?: boolean;\n  /** Displays Label Collision Boxes */\n  showCollisionBoxes?: boolean;\n  /** Displays all feature outlines even if normally not drawn by style rules */\n  showOverdrawInspector?: boolean;\n  /** Mouse Cursor Style */\n  cursorStyle?: string;\n  //** Dark Map Style */\n  darkStyle?: StyleSpecification | string;\n  //** Disable automatic map resize */\n  disableResize?: boolean;\n  //** MapLibre library */\n  mapLib?: any;\n  //** APIkey for vector service */\n  apikey?: string;\n  //** Debug Message Mode */\n  debug?: boolean;\n  //** Debug Events */\n  debugEvents?: boolean;\n  ref?: HTMLDivElement;\n  /** Children within the Map Container */\n  children?: any;\n} & mapEventTypes;\n\n/** Creates a new Map Container */\nexport const MapGL: Component<Props> = (props) => {\n  let map: Map;\n  let mapRef: HTMLDivElement;\n  let resizeObserver: ResizeObserver;\n  let mutationObserver: MutationObserver;\n\n  const [mapLoaded, setMapLoaded] = createSignal(null);\n  const [darkMode, setDarkMode] = createSignal(\n    (typeof window !== \"undefined\" &&\n      window.matchMedia(\"(prefers-color-scheme: dark)\").matches) ||\n      (typeof document !== \"undefined\" &&\n        document.body.classList.contains(\"dark\")),\n  );\n  const [internal, setInternal] = createSignal(false);\n\n  const debug = (text: string, value?: any) =>\n    (props.debug || props.debugEvents) &&\n    console.debug(\"%c[MapGL]\", \"color: #0ea5e9\", text, value || \"\");\n\n  const getStyle = (light: any, dark: any) => {\n    const style = darkMode() && dark ? dark : light;\n    return typeof style === \"string\" || style instanceof String\n      ? style\n          ?.split(\":\")\n          .reduce((p, c) => p && p[c], vectorStyleList)\n          ?.replace(\n            \"{apikey}\",\n            //@ts-ignore\n            props.apikey || import.meta.env.VITE_VECTOR_API_KEY,\n          ) || style\n      : style;\n  };\n\n  onMount(async () => {\n    let mapLib = props.mapLib || (await import(\"mapbox-gl\"));\n    if (!mapLib.Map) mapLib = window[\"maplibregl\"] || window[\"mapboxgl\"];\n\n    if (typeof mapLib.supported === \"function\" && !mapLib.supported())\n      throw new Error(\"Mapbox GL not supported\");\n\n    debug(`Map (v${mapLib.version}) loading...`);\n    map = new mapLib.Map({\n      accessToken:\n        //@ts-ignore\n        props.options?.accessToken || import.meta.env.VITE_MAPBOX_ACCESS_TOKEN,\n      interactive: props.options?.interactive || !!props.onViewportChange,\n      ...props.options,\n      ...props.viewport,\n      projection: props.options?.projection,\n      container: mapRef,\n      style: getStyle(props.options?.style, props.darkStyle),\n      fitBoundsOptions: { padding: props.viewport?.padding },\n    } as MapboxOptions);\n\n    map.debug = props.debug;\n    map.debugEvents = props.debugEvents;\n    map.sourceIdList = [];\n    map.layerIdList = [];\n    window.MapLib = mapLib;\n\n    // Hook up events\n    mapEvents.forEach((item) => {\n      const prop = props[item];\n      if (prop) {\n        const event = item.slice(2).toLowerCase();\n        if (typeof prop === \"function\") {\n          map.on(event, (evt) => {\n            setTimeout(() => {\n              if (evt.clickOnLayer) return;\n              prop(evt);\n              props.debugEvents && debug(`Map '${event}' event:`, evt);\n            }, 0);\n          });\n        } else {\n          Object.keys(prop).forEach((layerId) => {\n            map.on(event as any, layerId, (evt) => {\n              setTimeout(() => {\n                if (evt.clickOnLayer) return;\n                prop[layerId](evt);\n                props.debugEvents &&\n                  debug(`Map '${event}' event on '${layerId}':`, evt);\n              }, 0);\n            });\n          });\n        }\n      }\n    });\n\n    map.once(\"load\", () => {\n      setMapLoaded(map);\n      debug(\"Map loaded\");\n\n      // Handle User Interaction\n      [\"mousedown\", \"touchstart\", \"wheel\"].forEach((event) =>\n        map.on(event, (evt) => !evt.rotate && props.onUserInteraction?.(true)),\n      );\n      [\"moveend\", \"mouseup\", \"touchend\"].forEach((event) =>\n        map.on(event, (evt) => !evt.rotate && props.onUserInteraction?.(false)),\n      );\n\n      // Listen to dark theme changes\n      const darkTheme =\n        typeof window !== \"undefined\" &&\n        window?.matchMedia(\"(prefers-color-scheme: dark)\");\n      darkTheme?.addEventListener(\"change\", () => {\n        setDarkMode(darkTheme.matches);\n        debug(\"Set dark theme to:\", darkTheme.matches?.toString());\n      });\n      mutationObserver = new MutationObserver(() => {\n        const darkTheme = document.body.classList.contains(\"dark\");\n        setDarkMode(darkTheme);\n        debug(\"Set theme to:\", darkTheme);\n      });\n      mutationObserver.observe(document.body, { attributes: true });\n\n      // Listen to map container size changes\n      if (!props.disableResize) {\n        resizeObserver = new ResizeObserver(() => {\n          setTimeout(() => {\n            map?.resize();\n          }, 0);\n          debug(\"Map resized\");\n        });\n        resizeObserver.observe(mapRef as Element);\n      }\n\n      // Update Configuration\n      createEffect(() => {\n        for (const key in props.config) {\n          if (!key || key === \"id\") continue;\n          const id = props.config?.id || \"basemap\";\n          const value = props.config[key];\n          //@ts-ignore\n          map?.setConfigProperty(id, key, value);\n          debug(`Set Config (${id}:${key}) to:`, value);\n        }\n      });\n\n      // Update Viewport\n      map.on(\"move\", (event) => {\n        const viewport: Viewport = {\n          ...props.viewport,\n          id: props.id,\n          point: {\n            x: (event as any).originalEvent?.x,\n            y: (event as any).originalEvent?.y,\n          },\n          center: props.viewport?.center?.lat\n            ? map.getCenter()\n            : [map.getCenter().lng, map.getCenter().lat],\n          zoom: map.getZoom(),\n          pitch: map.getPitch(),\n          bearing: map.getBearing(),\n          inTransit: true,\n          bounds: null,\n          //   !internal()\n          //     ? props.viewport?.center?.lat\n          //       ? map.getBounds()\n          //       : [\n          //           [\n          //             map.getBounds().getNorthEast().lng,\n          //             map.getBounds().getNorthEast().lat,\n          //           ],\n          //           [\n          //             map.getBounds().getSouthWest().lng,\n          //             map.getBounds().getSouthWest().lat,\n          //           ],\n          //         ]\n          //     : null,\n        };\n        setInternal(true);\n        !event.viewport && props.onViewportChange?.(viewport);\n      });\n\n      map.on(\"moveend\", (event) => {\n        !event.rotate &&\n          props.onViewportChange?.({ ...props.viewport, inTransit: false });\n        setInternal(false);\n      });\n    });\n  });\n\n  // Hook up viewport event\n  createEffect(\n    on(\n      () => props.viewport,\n      (vp) => {\n        if (props.id !== vp?.id || internal()) return;\n        const viewport = {\n          ...vp,\n          ...(vp.bounds\n            ? map.cameraForBounds(vp.bounds, {\n                bearing: vp?.bearing,\n                pitch: vp?.pitch,\n                padding: vp?.padding,\n              })\n            : null),\n        };\n        map.stop()[props.transitionType || \"flyTo\"](viewport);\n        debug(\n          `Update Viewport (${props.transitionType || \"flyTo\"}):`,\n          viewport,\n        );\n      },\n      { defer: true },\n    ),\n  );\n\n  // Update Projection\n  createEffect(() => {\n    const proj = props.options?.projection;\n    if (!map || !proj) return;\n    map.setProjection(proj);\n    debug(\"Set Projection to:\", proj);\n  });\n\n  // Update Cursor\n  createEffect(() => {\n    const cur = props.cursorStyle;\n    if (!map || !cur) return;\n    map.getCanvas().style.cursor = cur;\n    debug(\"Set Cursor to:\", cur);\n  });\n\n  const insertLayers = (list, layers) => {\n    layers.forEach((layer) => {\n      const index = list.findIndex((i) =>\n        layer.metadata.smg.beforeType\n          ? i.type === layer.metadata.smg.beforeType\n          : i.id === layer.metadata.smg.beforeId,\n      );\n      list =\n        index === -1\n          ? [...list, layer]\n          : [...list.slice(0, index), layer, ...list.slice(index + 1)];\n    });\n    return list;\n  };\n\n  // Update map style\n  createEffect((prev) => {\n    const style = getStyle(props.options?.style, props.darkStyle);\n    if (map?.isStyleLoaded() && prev !== style) {\n      const oldStyle = map.getStyle();\n      const oldLayers = oldStyle.layers.filter((l) =>\n        map.layerIdList.includes(l.id),\n      );\n      const oldSources = Object.keys(oldStyle.sources)\n        .filter((s) => map.sourceIdList.includes(s))\n        .reduce((obj, key) => ({ ...obj, [key]: oldStyle.sources[key] }), {});\n\n      map.setStyle(style);\n      map.once(\"styledata\", () => {\n        if (!oldLayers) return;\n        const newStyle = map.getStyle();\n        map.setStyle({\n          ...newStyle,\n          sources: { ...newStyle.sources, ...oldSources },\n          layers: insertLayers(newStyle.layers, oldLayers),\n          fog: oldStyle.fog,\n          terrain: oldStyle.terrain,\n        });\n        debug(\"Set Mapstyle to:\", style);\n      });\n    }\n    return style;\n  }, props.options?.style);\n\n  // Update debug features\n  [\n    \"showTileBoundaries\",\n    \"showTerrainWireframe\",\n    \"showCollisionBoxes\",\n    \"showPadding\",\n    \"showOverdrawInspector\",\n  ].forEach((item) => {\n    createEffect(() => {\n      const prop = props[item];\n      if (!map || !prop) return;\n      map[item] = prop;\n      debug(`Set ${item} to:`, prop);\n    });\n  });\n\n  onCleanup(() => {\n    resizeObserver?.disconnect();\n    mutationObserver?.disconnect();\n    map?.remove();\n    debug(\"Map removed\");\n  });\n\n  return (\n    <div\n      ref={mapRef}\n      id={props.id}\n      class={props?.class}\n      classList={props?.classList}\n      style={\n        props?.class || props?.classList\n          ? null\n          : props.style || {\n              position: \"absolute\",\n              inset: 0,\n              \"z-index\": -1,\n            }\n      }\n    >\n      {mapLoaded() && (\n        <MapProvider map={mapLoaded()}>\n          <style>{`.overlay{position:relative;width:100%;height:100%;pointer-events:none}.overlay>*{pointer-events:auto}`}</style>\n          <div class=\"overlay\">{props.children}</div>\n        </MapProvider>\n      )}\n    </div>\n  );\n};\n","import {\n  onCleanup,\n  createEffect,\n  Component,\n  createContext,\n  useContext,\n  createUniqueId,\n} from 'solid-js'\nimport { useMapContext } from '../MapProvider'\nimport type { SourceSpecification } from 'mapbox-gl/src/style-spec/types.js'\nimport { rasterStyleList } from '../../mapStyles'\n\nconst SourceContext = createContext<string>()\nexport const useSourceId = (): string => useContext(SourceContext)\n\ntype Props = {\n  /** @optional Source ID for referencing non nexted Layers */\n  id?: string\n  /** @see https://docs.mapbox.com/mapbox-gl-js/style-spec/sources/ */\n  source: SourceSpecification\n  /** The map layers associated with this source */\n  children?: any\n}\n\nexport const Source: Component<Props> = props => {\n  const [ctx] = useMapContext()\n  props.id ??= createUniqueId()\n\n  const debug = (text, value?) => {\n    ctx.map.debug &&\n      console.debug('%c[MapGL]', 'color: #ec4899', text, value || '')\n  }\n\n  const lookup = url => {\n    const s = url?.split(':').reduce((p, c) => p && p[c], rasterStyleList)\n    const source = s\n      ? {\n        ...props.source,\n        url: '',\n        tiles: [\n          s\n            .replace(\n              '{apikey}', //@ts-ignore\n              props.source.apikey || import.meta.env.VITE_RASTER_API_KEY\n            )\n            .replace('{r}', window.devicePixelRatio > 1 ? '@2x' : ''),\n        ],\n        attribution: rasterStyleList[url.split(':')[0]]._copy,\n      }\n      : props.source\n\n    source.tiles &&\n      (source.tiles = ['a', 'b', 'c'].map(i =>\n        source.tiles[0].replace('{s}', i)\n      ))\n\n    return source\n  }\n\n  // Add Source\n  ctx.map.addSource(props.id, lookup(props.source.url))\n  ctx.map.sourceIdList.push(props.id)\n  debug('Add Source:', props.id)\n\n  // Update Data\n  const source = ctx.map.getSource(props.id)\n  switch (props.source.type) {\n    case 'geojson':\n      createEffect(() => {\n        const data = props.source.data\n        if (!ctx.map.isSourceLoaded(props.id)) return\n        source.setData(data || {})\n        debug('Update GeoJSON Data:', props.id)\n      })\n      break\n    case 'image':\n      createEffect(() => {\n        const url = props.source.url\n        const coords = props.source.coordinates\n        if (!ctx.map.isSourceLoaded(props.id)) return\n        source.updateImage(url, coords)\n        debug('Update Image Data:', props.id)\n      })\n      break\n    case 'vector':\n      createEffect(() => {\n        const url = props.source.url\n        const tiles = props.source.tiles\n        if (!ctx.map.isSourceLoaded(props.id)) return\n        url ? source.setUrl(url) : source.setTiles(tiles)\n        debug('Update Vector Data:', props.id)\n      })\n      break\n    case 'raster':\n      createEffect(() => {\n        const src = lookup(props.source.url)\n        if (!ctx.map.isSourceLoaded(props.id)) return\n        src.url ? source.setUrl(src.url) : source.setTiles(src.tiles)\n        debug('Update Raster Data:', props.id)\n      })\n      break\n  }\n\n  // Remove Source\n  onCleanup(() => {\n    ctx.map\n      ?.getStyle()\n      .layers.forEach(\n        layer => layer.source === props.id && ctx.map.removeLayer(layer.id)\n      )\n    ctx.map?.getSource(props.id) && ctx.map?.removeSource(props.id)\n    debug('Remove Source:', props.id)\n  })\n\n  return (\n    <SourceContext.Provider value={props.id}>\n      {props.children}\n    </SourceContext.Provider>\n  )\n}\n","export const baseStyle = [\n    'id',\n    'type',\n    'filter',\n    'source',\n    'source-layer',\n    'minzoom',\n    'metadata',\n    'maxzoom',\n    'paint',\n    'layout'\n  ]\n\nexport const layoutStyles = [\n    'visibility',\n    'line-join',\n    'line-cap',\n    'line-miter-limit',\n    'line-round-limit',\n    'line-sort-key',\n    'circle-sort-key',\n    'symbol-avoid-edges',\n    'symbol-placement',\n    'symbol-sort-key',\n    'symbol-spacing',\n    'symbol-z-order',\n    'icon-allow-overlap',\n    'icon-anchor',\n    'icon-ignore-placement',\n    'icon-image',\n    'icon-keep-upright',\n    'icon-offset',\n    'icon-optional',\n    'icon-padding',\n    'icon-pitch-alignment',\n    'icon-rotate',\n    'icon-rotation-alignment',\n    'icon-size',\n    'icon-text-fit',\n    'icon-text-fit-padding',\n    'text-allow-overlap',\n    'text-anchor',\n    'text-field',\n    'text-font',\n    'text-ignore-placement',\n    'text-justify',\n    'text-keep-upright',\n    'text-letter-spacing',\n    'text-line-height',\n    'text-max-angle',\n    'text-max-width',\n    'text-offset',\n    'text-optional',\n    'text-padding',\n    'text-pitch-alignment',\n    'text-radial-offset',\n    'text-rotate',\n    'text-rotation-alignment',\n    'text-size',\n    'text-transform',\n    'text-variable-anchor',\n    'text-writing-mode'\n]","import { onCleanup, createEffect, Component, createUniqueId } from \"solid-js\";\nimport { useMapContext } from \"../MapProvider\";\nimport { useSourceId } from \"../Source\";\nimport { layerEvents } from \"../../events\";\nimport { baseStyle, layoutStyles } from \"../../styles\";\nimport type { layerEventTypes } from \"../../events\";\nimport type {\n  FilterSpecification,\n  StyleSpecification,\n} from \"mapbox-gl/src/style-spec/types.js\";\nimport type { CustomLayerInterface } from \"mapbox-gl/src/style/style_layer/custom_style_layer\";\n\nconst diff = (\n  newProps: StyleSpecification = {},\n  prevProps: StyleSpecification = {},\n): [string, any][] => {\n  const keys = new Set([...Object.keys(newProps), ...Object.keys(prevProps)]);\n  return [...keys].reduce((acc, key: string) => {\n    const value = newProps[key];\n    if (value !== prevProps[key]) {\n      acc.push([key, value]);\n    }\n    return acc;\n  }, []);\n};\n\ntype Props = {\n  id?: string;\n  /** A string that uniquely identifies the layer. If not provided, a unique ID will be generated. */\n  style?: StyleSpecification;\n  /** A Mapbox Style Specification object that defines the visual appearance of the layer. */\n  customLayer?: CustomLayerInterface;\n  /** An object that implements the `CustomLayerInterface` interface, which allows you to create custom layers using WebGL. */\n  filter?: FilterSpecification;\n  /** A Mapbox filter specification that defines which features of the layer to include or exclude from the layer. */\n  visible?: boolean;\n  /** A boolean that determines whether the layer is visible or not. */\n  sourceId?: string;\n  /** A string that specifies the ID of the source that the layer uses for its data. */\n  slot?: \"bottom\" | \"middle\" | \"top\" | string;\n  /** A string that specifies the slot to which the layer belongs. */\n  beforeType?:\n    | \"background\"\n    | \"fill\"\n    | \"line\"\n    | \"symbol\"\n    | \"raster\"\n    | \"circle\"\n    | \"fill-extrusion\"\n    | \"heatmap\"\n    | \"hillshade\"\n    | \"sky\"\n    | string;\n  /** A string that specifies the type of layer before which the current layer should be inserted. */\n  beforeId?: string;\n  /** A string that specifies the ID of the layer before which the current layer should be inserted. */\n  featureState?: { id: number | string; state: object };\n  /** An object that specifies the state of a feature in the layer. The object consists of an ID (either a number or a string) and an object containing the state. */\n  children?: any;\n  /** Any content that should be rendered within the layer. */\n} & layerEventTypes;\n\nconst newKey = (key, type) =>\n  (key.startsWith(type) || key.startsWith(\"icon\") || key.startsWith(\"text\")\n    ? \"\"\n    : type + \"-\") + key.replace(/[A-Z]/g, (s) => \"-\" + s.toLowerCase());\n\nconst updateStyle = (oldStyle) => {\n  if (!oldStyle) return;\n  let layout = {};\n  let paint = {};\n  let style = {};\n\n  Object.entries(oldStyle).forEach(([key, value]) => {\n    if (baseStyle.includes(key)) style[key] = value;\n    else {\n      const nk = newKey(key, oldStyle.type);\n      layoutStyles.includes(nk) ? (layout[nk] = value) : (paint[nk] = value);\n    }\n  });\n  if (oldStyle.paint)\n    Object.entries(oldStyle.paint).forEach(\n      ([key, value]) => (paint[newKey(key, oldStyle.type)] = value),\n    );\n  if (oldStyle.layout)\n    Object.entries(oldStyle.layout).forEach(\n      ([key, value]) => (layout[newKey(key, oldStyle.type)] = value),\n    );\n  return { ...style, paint, layout } as StyleSpecification;\n};\n\nexport const Layer: Component<Props> = (props) => {\n  const [ctx] = useMapContext();\n  const sourceId: string = props.style?.source || useSourceId();\n  props.id = props.id || props.customLayer?.id || createUniqueId();\n\n  const debug = (text, value?) => {\n    (ctx.map.debug || ctx.map.debugEvents) &&\n      console.debug(\"%c[MapGL]\", \"color: #10b981\", text, value || \"\");\n  };\n\n  // Add Layer\n  ctx.map.addLayer(\n    props.customLayer || {\n      ...updateStyle(props.style),\n      id: props.id,\n      source: sourceId,\n      slot: props.slot || \"\",\n      metadata: {\n        smg: { beforeType: props.beforeType, beforeId: props.beforeId },\n      },\n    },\n    props.beforeType\n      ? ctx.map.getStyle().layers.find((l) => l.type === props.beforeType)?.id\n      : props.beforeId,\n  );\n  ctx.map.layerIdList.push(props.id);\n  if (props.customLayer) ctx.map.fire(\"load\");\n  debug(\"Add Layer:\", props.id);\n\n  // Hook up events\n  layerEvents.forEach((item) => {\n    if (props[item]) {\n      const event = item.slice(2).toLowerCase();\n      ctx.map.on(event, props.id, (evt) => {\n        evt.clickOnLayer = true;\n        props[item](evt);\n        ctx.map.debugEvent &&\n          debug(`Layer '${event}' event on '${props.id}':`, evt);\n      });\n    }\n  });\n\n  // Update Style\n  createEffect((prev: StyleSpecification) => {\n    const style = updateStyle(props.style);\n    if (style === prev) return;\n\n    if (style.layout !== prev?.layout)\n      diff(style.layout, prev?.layout).forEach(([key, value]) =>\n        ctx.map.setLayoutProperty(props.id, key, value, { validate: false }),\n      );\n\n    if (style.paint !== prev?.paint)\n      diff(style.paint, prev?.paint).forEach(([key, value]) =>\n        ctx.map.setPaintProperty(props.id, key, value, { validate: false }),\n      );\n\n    if (style.minzoom !== prev?.minzoom || style.maxzoom !== prev?.maxzoom)\n      ctx.map.setLayerZoomRange(props.id, style.minzoom, style.maxzoom);\n\n    if (style.filter !== prev?.filter)\n      ctx.map.setFilter(props.id, style.filter, { validate: false });\n\n    debug(\"Update Layer Style:\", props.id);\n    return style;\n  }, updateStyle(props.style));\n\n  // Update Visibility\n  createEffect((prev: boolean) => {\n    if (props.visible === prev) return;\n\n    ctx.map.setLayoutProperty(\n      props.id,\n      \"visibility\",\n      props.visible ? \"visible\" : \"none\",\n      { validate: false },\n    );\n    debug(`Update Visibility (${props.id}):`, props.visible.toString());\n    return props.visible;\n  }, props.visible);\n\n  // Update Filter\n  createEffect(async () => {\n    if (!props.filter) return;\n\n    !ctx.map.isStyleLoaded() && (await ctx.map.once(\"styledata\"));\n    ctx.map.setFilter(props.id, props.filter);\n    debug(`Update Filter (${props.id}):`, props.filter);\n  });\n\n  // Update Feature State\n  createEffect(async () => {\n    if (!props.featureState || props.featureState.id === null) return;\n\n    !ctx.map.isStyleLoaded() && (await ctx.map.once(\"styledata\"));\n\n    ctx.map.removeFeatureState({\n      source: sourceId,\n      sourceLayer: props.style[\"source-layer\"],\n    });\n    ctx.map.setFeatureState(\n      {\n        source: sourceId,\n        sourceLayer: props.style[\"source-layer\"],\n        id: props.featureState.id,\n      },\n      props.featureState.state,\n    );\n  });\n\n  //Remove Layer\n  onCleanup(\n    () => ctx.map?.getLayer(props.id) && ctx.map?.removeLayer(props.id),\n  );\n\n  return props.children;\n};\n","import { onCleanup, VoidComponent, createUniqueId, onMount } from 'solid-js'\nimport { useMapContext } from '../MapProvider'\n\ndeclare global {\n  interface Window {\n    BABYLON?: any\n    THREE?: any\n  }\n}\n\ntype Props = {\n  id?: string\n  origin?: [number, number, number?] // [lng, lat, altitude]\n  defaultLight?: boolean\n  babylon?: boolean\n  onAdd?: (scene: any, map: any, gl: any) => void\n  onRender?: (gl: any, matrix: any) => void\n}\nexport const Layer3D: VoidComponent<Props> = (props) => {\n  const [ctx] = useMapContext()\n\n  onMount(async () => {\n    props.id = props.id || createUniqueId()\n\n    const worldOriginMercator = window.MapLib.MercatorCoordinate.fromLngLat(\n      props.origin ? [props.origin[0], props.origin[1]] : [0, 0],\n      props.origin ? props.origin[2] : 0\n    )\n    const worldScale = worldOriginMercator.meterInMercatorCoordinateUnits()\n\n    let worldMatrix = null\n    let BABYLON = null\n    let THREE = null\n\n    if (props.babylon) {\n      BABYLON = await import('@babylonjs/core')\n      worldMatrix = BABYLON.Matrix.Compose(\n        new BABYLON.Vector3(worldScale, worldScale, worldScale),\n        BABYLON.Quaternion.FromEulerAngles(Math.PI / 2, 0, 0),\n        new BABYLON.Vector3(\n          worldOriginMercator.x,\n          worldOriginMercator.y,\n          worldOriginMercator.z\n        )\n      )\n    } else {\n      THREE = await import('three')\n      worldMatrix = {\n        translateX: worldOriginMercator.x,\n        translateY: worldOriginMercator.y,\n        translateZ: worldOriginMercator.z,\n        rotateX: Math.PI / 2,\n        rotateY: 0,\n        rotateZ: 0,\n        scale: worldScale,\n      }\n    }\n\n    ctx.map.addLayer({\n      id: props.id,\n      type: 'custom',\n      renderingMode: '3d',\n      onAdd(map, gl) {\n        if (props.babylon) {\n          const engine = new BABYLON.Engine(\n            gl,\n            true,\n            {\n              useHighPrecisionMatrix: true,\n            },\n            true\n          )\n          this.scene = new BABYLON.Scene(engine)\n          this.scene.autoClear = false\n          this.scene.detachControl()\n          this.scene.beforeRender = () => engine.wipeCaches(true)\n          this.scene.activeCamera = new BABYLON.Camera(\n            'Camera',\n            new BABYLON.Vector3(),\n            this.scene\n          )\n          if (props.defaultLight)\n            new BABYLON.HemisphericLight(\n              'Light',\n              new BABYLON.Vector3(1, 0, 0),\n              this.scene\n            )\n        } else {\n          this.camera = new THREE.Camera()\n          this.scene = new THREE.Scene()\n          if (props.defaultLight) {\n            this.light = new THREE.DirectionalLight(0xffffff)\n            this.light.position.set(100, 0, 0).normalize()\n            this.scene.add(this.light)\n          }\n\n          this.renderer = new THREE.WebGLRenderer({\n            canvas: map.getCanvas(),\n            context: gl,\n            antialias: true,\n          })\n          this.renderer.autoClear = false\n        }\n        this.map = map\n        props.onAdd && props.onAdd(this.scene, this.map, gl)\n      },\n      render(gl, matrix) {\n        if (props.babylon) {\n          this.scene.activeCamera.freezeProjectionMatrix(\n            worldMatrix.multiply(BABYLON.Matrix.FromArray(matrix))\n          )\n          const { x, y, z } = this.map.getFreeCameraOptions().position\n          this.scene.activeCamera.position =\n            BABYLON.Vector3.TransformCoordinates(\n              new BABYLON.Vector3(x, y, z),\n              this.scene.activeCamera.getProjectionMatrix().clone().invert()\n            )\n          this.scene.render(false)\n        } else {\n          const rotationX = new THREE.Matrix4().makeRotationAxis(\n            new THREE.Vector3(1, 0, 0),\n            worldMatrix.rotateX\n          )\n          const rotationY = new THREE.Matrix4().makeRotationAxis(\n            new THREE.Vector3(0, 1, 0),\n            worldMatrix.rotateY\n          )\n          const rotationZ = new THREE.Matrix4().makeRotationAxis(\n            new THREE.Vector3(0, 0, 1),\n            worldMatrix.rotateZ\n          )\n\n          const m = new THREE.Matrix4().fromArray(matrix)\n          const l = new THREE.Matrix4()\n            .makeTranslation(\n              worldMatrix.translateX,\n              worldMatrix.translateY,\n              worldMatrix.translateZ\n            )\n            .scale(\n              new THREE.Vector3(\n                worldMatrix.scale,\n                -worldMatrix.scale,\n                worldMatrix.scale\n              )\n            )\n            .multiply(rotationX)\n            .multiply(rotationY)\n            .multiply(rotationZ)\n          this.camera.projectionMatrix = m.multiply(l)\n          this.renderer.resetState()\n          this.renderer.render(this.scene, this.camera)\n        }\n        props.onRender && props.onRender(gl, matrix)\n        ctx.map.triggerRepaint()\n      },\n    })\n  })\n\n  onCleanup(() => {\n    ctx.map.getLayer(props.id) && ctx.map.removeLayer(props.id)\n  })\n\n  return null\n}\n","import { onCleanup, createEffect, VoidComponent } from \"solid-js\";\nimport { useMapContext } from \"../MapProvider\";\nimport type { Fog } from \"mapbox-gl\";\n\ninterface AtmosphereProps {\n  /** Fog/Atmosphere Specifications */\n  style?: Fog;\n}\n\nexport const Atmosphere: VoidComponent<AtmosphereProps> = (props) => {\n  const [ctx] = useMapContext();\n\n  // Add or Update Atmosphere Layer\n  createEffect(() => ctx.map.setFog(props.style || {}));\n\n  // Remove Atmosphere Layer\n  onCleanup(() => {\n    if (ctx.map.getFog()) ctx.map.setFog(null);\n  });\n\n  return null;\n};\n","import {\n  createEffect,\n  VoidComponent,\n  createUniqueId,\n  onCleanup,\n} from 'solid-js'\nimport { useMapContext } from '../MapProvider'\nimport { useSourceId } from '../Source'\n\ninterface TerrainSpecification {\n  source?: string\n  exaggeration?: number | undefined\n}\n\nexport const Terrain: VoidComponent<TerrainSpecification> = (\n  props?: TerrainSpecification\n) => {\n  const [ctx] = useMapContext()\n  let sourceId: string = useSourceId()\n\n  // Add Terrain Source if not already defined\n  if (!sourceId && !props?.source) {\n    sourceId = createUniqueId()\n    ctx.map.addSource(sourceId, {\n      type: 'raster-dem',\n      url: ctx.map.isMapLibre\n        ? 'https://demotiles.maplibre.org/terrain-tiles/tiles.json'\n        : 'mapbox://mapbox.terrain-rgb',\n      tileSize: ctx.map.isMapLibre ? 256 : 512,\n      maxzoom: ctx.map.isMapLibre ? undefined : 14,\n    })\n    ctx.map.sourceIdList.push(sourceId)\n  }\n\n  // Add or Update Terrain Layer\n  createEffect(() => {\n    ctx.map.setTerrain({\n      exaggeration: props.exaggeration || 1,\n      source: props?.source || sourceId,\n    })\n  })\n\n  //Remove Terrain\n  onCleanup(() => ctx.map?.setTerrain(null))\n\n  return null\n}\n","import {\n  createSignal,\n  createEffect,\n  onCleanup,\n  splitProps,\n  untrack,\n  VoidComponent,\n} from \"solid-js\";\nimport { useMapContext } from \"../MapProvider\";\nimport type { Options as AttributionOptions } from \"mapbox-gl/src/ui/control/attribution_control\";\nimport type { Options as FullscreenOptions } from \"mapbox-gl/src/ui/control/fullscreen_control\";\nimport type { Options as GeolocateOptions } from \"mapbox-gl/src/ui/control/geolocate_control\";\nimport type { Options as NavigationOptions } from \"mapbox-gl/src/ui/control/navigation_control\";\nimport type { Options as ScaleOptions } from \"mapbox-gl/src/ui/control/scale_control\";\n\ntype ControlType =\n  | \"navigation\"\n  | \"scale\"\n  | \"attribution\"\n  | \"fullscreen\"\n  | \"geolocate\"\n  | \"logo\"\n  | \"terrain\";\n\ntype Props = {\n  type?: ControlType;\n  options?:\n    | NavigationOptions\n    | ScaleOptions\n    | AttributionOptions\n    | FullscreenOptions\n    | GeolocateOptions\n    | object;\n  custom?: any;\n  position?: \"top-left\" | \"top-right\" | \"bottom-left\" | \"bottom-right\";\n};\n\nexport const Control: VoidComponent<Props> = (props) => {\n  const [ctx] = useMapContext();\n  const [update, create] = splitProps(props, [\"position\"]);\n  const [control, setControl] = createSignal<any>(null);\n\n  const controlClasses = new Map<ControlType, any>([\n    [\"navigation\", window.MapLib.NavigationControl],\n    [\"scale\", window.MapLib.ScaleControl],\n    [\"attribution\", window.MapLib.AttributionControl],\n    [\"geolocate\", window.MapLib.GeolocateControl],\n    [\"fullscreen\", window.MapLib.FullscreenControl],\n    [\"logo\", window.MapLib.LogoControl],\n    [\"terrain\", window.MapLib.TerrainControl],\n  ]);\n\n  // Add Control\n  createEffect(() => {\n    untrack(\n      () =>\n        control() &&\n        ctx.map.hasControl(control()) &&\n        ctx.map.removeControl(control()),\n    );\n    setControl(\n      create.custom ||\n        new (controlClasses.get(create.type || \"navigation\"))(create.options),\n    );\n  });\n\n  // Update Position\n  createEffect(() => {\n    ctx.map.hasControl(control()) && ctx.map.removeControl(control());\n    ctx.map.addControl(control(), update.position);\n  });\n\n  onCleanup(() => {\n    ctx.map.hasControl(control()) && ctx.map.removeControl(control());\n  });\n\n  return null;\n};\n","import { onCleanup, createEffect, Component, splitProps } from 'solid-js'\nimport { useMapContext } from '../MapProvider'\nimport type {\n  Popup as PopupType,\n  PopupOptions,\n  Marker as MarkerType,\n  MarkerOptions,\n  LngLatLike,\n} from 'mapbox-gl'\n\ntype Props = {\n  /** The geographical location to place the marker */\n  lngLat: LngLatLike\n  /** Options for the Mapbox GL JS marker */\n  options?: MarkerOptions\n  /** Options for the Mapbox GL JS popup that is associated with the marker */\n  popup?: PopupOptions\n  /** Whether the marker's associated popup should be open */\n  showPopup?: boolean\n  /** Whether the marker is draggable */\n  draggable?: boolean\n  /** A function that is called when the marker's associated popup is opened */\n  onOpen?: () => void\n  /** A function that is called when the marker's associated popup is closed */\n  onClose?: () => void\n  /** A function that is called when the marker starts being dragged */\n  onDragStart?: () => void\n  /** A function that is called when the marker stops being dragged */\n  onDragEnd?: () => void\n  /** A function that is called when the marker is being dragged */\n  onDrag?: (lngLat: number[]) => void\n  /** The content to be displayed in the marker's associated popup */\n  children?: any\n}\n\nexport const Marker: Component<Props> = (props: Props) => {\n  if (!props.lngLat) throw new Error('Marker - lngLat is required')\n  const [update, create_popup, create_marker] = splitProps(\n    props,\n    ['lngLat', 'children', 'showPopup', 'draggable'],\n    ['popup', 'onOpen', 'onClose']\n  )\n\n  const [ctx] = useMapContext()\n  let marker: MarkerType = null\n  let popup: PopupType = null\n  const LNGLAT = update.lngLat\n\n  // Add or Update Popup\n  createEffect(() => {\n    if (!ctx.map) return\n    popup?.remove()\n    popup = new window.MapLib.Popup({\n      closeOnClick: false,\n      focusAfterOpen: false,\n      ...create_popup.popup,\n    })\n      .on('open', () => create_popup.onOpen?.())\n      .on('close', () => create_popup.onClose?.())\n\n    // Update Popup Content\n    createEffect(() => {\n      if (update.children === undefined) return\n      typeof update.children === 'string'\n        ? popup?.setHTML(update.children)\n        : popup?.setDOMContent(update.children)\n      marker?.setPopup(popup)\n    })\n\n    // Toggle Popup\n    createEffect(\n      () => update.showPopup !== popup?.isOpen() && marker?.togglePopup()\n    )\n  })\n\n  // Add or Update Marker\n  createEffect(() => {\n    if (!ctx.map) return\n    marker?.remove()\n    marker = new window.MapLib.Marker(create_marker.options)\n      .on('dragstart', () => create_marker.onDragStart?.())\n      .on('dragend', () => create_marker.onDragEnd?.())\n      .on('drag', () => create_marker.onDrag?.(marker?.getLngLat().toArray()))\n      .setPopup(popup)\n      .setLngLat(LNGLAT)\n      .addTo(ctx.map)\n\n    // Toggle Popup\n    createEffect(\n      () => update.showPopup !== popup?.isOpen() && marker?.togglePopup()\n    )\n  })\n\n  // Update Position\n  createEffect(() => marker?.setLngLat(update.lngLat))\n\n  // Update Draggable\n  createEffect(() => marker?.setDraggable(update.draggable))\n\n  // Remove Marker\n  onCleanup(() => marker?.remove())\n\n  return null\n}\n","import { onCleanup, createEffect, Component, splitProps } from 'solid-js'\nimport { useMapContext } from '../MapProvider'\nimport type { Popup as PopupType, PopupOptions, LngLatLike } from 'mapbox-gl'\n\ntype Props = {\n  /** Options for configuring the popup */\n  options?: PopupOptions\n  /** Flag for tracking the mouse pointer */\n  trackPointer?: boolean\n  /** Longitude and latitude for the popup */\n  lngLat?: LngLatLike\n  /** Callback for when the popup is opened */\n  onOpen?: () => void\n  /** Callback for when the popup is closed */\n  onClose?: () => void\n  /** Children to display within the popup */\n  children?: any\n}\n\nexport const Popup: Component<Props> = (props: Props) => {\n  if (!props.trackPointer && !props.lngLat)\n    throw new Error('Popup - lngLat or trackPointer is required')\n\n  const [update, create] = splitProps(props, [\n    'lngLat',\n    'children',\n    'trackPointer',\n  ])\n  const [ctx] = useMapContext()\n  let popup: PopupType | undefined\n\n  // Update Popup\n  createEffect(() => {\n    if (!ctx.map) return\n    popup?.remove()\n    popup = new window.MAPLIB.Popup({\n      closeOnClick: false,\n      focusAfterOpen: false,\n      ...create.options,\n    })\n      .on('open', () => create.onOpen?.())\n      .on('close', () => create.onClose?.())\n      .addTo(ctx.map)\n\n    // Update Position\n    createEffect(() =>\n      update.trackPointer\n        ? popup.trackPointer()\n        : popup.setLngLat(update.lngLat)\n    )\n\n    // Update Content\n    createEffect(() =>\n      typeof update.children === 'string'\n        ? popup.setHTML(update.children)\n        : popup.setDOMContent(update.children)\n    )\n  })\n\n  // Remove Popup\n  onCleanup(() => popup?.remove())\n\n  return null\n}\n","import {\n  onCleanup,\n  createSignal,\n  createEffect,\n  VoidComponent,\n  untrack,\n} from 'solid-js'\nimport { useMapContext } from '../MapProvider'\nimport type {\n  StyleImageInterface,\n  StyleImageMetadata,\n} from 'mapbox-gl/src/style/style_image'\n\nconst PATTERN = {\n  diagonal_l: { size: 20, path: 'M20 0 0 20M-10 10 10-10M10 30 30 10' },\n  diagonal_r: { size: 20, path: 'M0 0 20 20M30 10 10-10M10 30-10 10' },\n  horizontal: { size: 14, path: 'M7 0V20' },\n  vertical: { size: 14, path: 'M0 7H20' },\n  cross: { size: 18, path: 'M9 0V18M0 9H18' },\n  hash: { size: 30, path: 'M15 0 30 15 15 30 0 15Z' },\n  chevron_h: { size: 20, path: 'M-5 5 0 10 10 0 20 10 25 5M0 30 10 20 20 30' },\n  chevron_v: { size: 20, path: 'M5-5 10 0 0 10 10 20 5 25M25 15 20 10 25 5' },\n  square: { size: 20, path: 'M8 8H12V12H8Z', fill: true },\n  hex: { size: 50, path: 'M0 0V50L50 25ZM50 0V50L0 25ZM25 0V50' },\n  circle: {\n    size: 25,\n    path: 'M8 10A2.5 2.5 0 118.01 10M18 15A2.5 2.5 0 1018.01 15',\n    fill: true,\n  },\n}\n\nexport const patternList = Object.keys(PATTERN)\n\nexport type Color =\n  | `#${string}`\n  | `rgb(${number}, ${number}, ${number})`\n  | `rgba(${number}, ${number}, ${number}, ${number})`\n  | `hsl(${number}, ${number}%, ${number}%)`\n  | `hsla(${number}, ${number}%, ${number}%, ${number})`\n\ntype Props = {\n  id: string\n  /** The unique identifier for the image. */\n  source?:\n  | HTMLImageElement\n  | ImageBitmap\n  | ImageData\n  | SVGElement\n  | { width: number; height: number; data: Uint8Array | Uint8ClampedArray }\n  | StyleImageInterface\n  | string\n  /** The image to be used for the image component. */\n  options?: StyleImageMetadata & {\n    fill?: Color\n    stroke?: Color\n    transform?: string\n  }\n  /**  The options for the image */\n  pattern?: {\n    type: string\n    color: Color\n    background: Color\n    lineWith: number\n  }\n  /** The pattern to be used for the image component. */\n}\n\nexport const MGL_Image: VoidComponent<Props> = props => {\n  const [ctx] = useMapContext()\n  const [size, setSize] = createSignal({ width: 0, height: 0 })\n\n  const debug = (text, value?) => {\n    ctx.map.debug &&\n      console.debug('%c[MapGL]', 'color: #10b981', text, value || '')\n  }\n\n  // Remove Image\n  onCleanup(() => {\n    ctx.map?.hasImage(props.id) && ctx.map?.removeImage(props.id)\n    debug('Remove Image:', props.id)\n  })\n\n  // Add or Update Image\n  createEffect(() => {\n    if (!props.id) throw new Error('Image - ID is required')\n    if (!props.source && !props.pattern)\n      throw new Error('Image - Image or Pattern is required')\n\n    const ops = props.pattern\n      ? { pixelRatio: 2, ...props.options }\n      : props.options\n\n    _loadImage(props.source || _createPattern(props.pattern), data => {\n      const { width, height } = data\n      if (ctx.map && !ctx.map.hasImage(props.id))\n        ctx.map.addImage(props.id, data, ops)\n      if (\n        !props.pattern &&\n        untrack(() => width === size().width && height === size().height)\n      ) {\n        ctx.map.updateImage(props.id, data)\n        ctx.map.triggerRepaint()\n      } else {\n        ctx.map.removeImage(props.id)\n        ctx.map.addImage(props.id, data, ops)\n      }\n      setSize({ width, height })\n      debug('Add Image:', props.id)\n      ctx.map.on('style.load', () => {\n        if (ctx.map.hasImage(props.id)) return\n        ctx.map.addImage(props.id, data, ops)\n        debug('Re-Add Image:', props.id)\n      })\n    })\n  })\n\n  // Load Image / SVG\n  const _loadImage = (image, callback) => {\n    if (typeof image == 'string' && image?.trimStart().startsWith('<svg')) {\n      image = new DOMParser().parseFromString(image, 'image/svg+xml')\n        .childNodes[0]\n    }\n    if (image instanceof SVGElement) {\n      props.options?.fill && image.setAttribute('fill', props.options.fill)\n      props.options?.stroke &&\n        image.setAttribute('stroke', props.options.stroke)\n      image = new XMLSerializer().serializeToString(image)\n    }\n    if (typeof image !== 'string') return callback(image)\n    ctx.map.loadImage(image, async (error, imageData) => {\n      if (error) {\n        if (typeof image == 'string' && image?.trimEnd().endsWith('.svg')) {\n          image = await (await fetch(image)).text()\n          image = new DOMParser().parseFromString(image, 'image/svg+xml')\n            .childNodes[0]\n          image.setAttribute('fill', props.options.fill)\n          image.setAttribute('stroke', props.options.stroke)\n          image.setAttribute('transform', props.options.transform)\n          image = new XMLSerializer().serializeToString(image)\n        }\n        const img = new Image()\n        img.crossOrigin = 'Anonymous'\n        img.onload = () => {\n          const canvas = document.createElement('canvas')\n          canvas.width = Math.max(img.width, 50)\n          canvas.height = Math.max(img.height, 50)\n          const ctx = canvas.getContext('2d')\n          ctx.imageSmoothingEnabled = true\n          ctx.drawImage(img, 0, 0, canvas.width, canvas.height)\n          return callback(ctx.getImageData(0, 0, canvas.width, canvas.height))\n        }\n        img.src = image.trimStart().startsWith('<svg')\n          ? 'data:image/svg+xml;charset=utf-8,' + image\n          : image\n      } else {\n        return callback(imageData)\n      }\n    })\n  }\n\n  const _createPattern = pattern => {\n    const p = PATTERN[pattern.type]\n    return {\n      width: p.size,\n      height: p.size,\n      data: new Uint8Array(p.size * p.size * 4),\n      onAdd: function () {\n        let canvas = document.createElement('canvas')\n        canvas.width = canvas.height = p.size\n        this.ctx = canvas.getContext('2d', { willReadFrequently: true })\n      },\n      render: function () {\n        this.ctx.fillStyle = pattern.background || 'transparent'\n        this.ctx.fillRect(0, 0, this.width, this.height)\n        this.ctx.strokeStyle = this.ctx.fillStyle = pattern.color || 'black'\n        this.ctx.lineWidth = pattern.lineWith || 1\n        this.ctx.stroke(new Path2D(p.path))\n        if (p.fill) this.ctx.fill(new Path2D(p.path))\n        this.data = this.ctx.getImageData(0, 0, this.width, this.height).data\n        return true\n      },\n    }\n  }\n\n  return null\n}\n","import { createEffect, Component, onCleanup, createSignal } from 'solid-js'\nimport { useMapContext } from '../MapProvider'\nimport type { LngLatLike } from 'mapbox-gl'\n\n// linearly interpolate between two positions [x,y,z] based on time\nconst lerp = (a: number[], b: number[], t: number): number[] =>\n  a.map((_, idx) => (1.0 - t) * a[idx] + t * b[idx])\n\n// sphericaly interpolate between two positions [x,y,z] based on time\nconst slerp = (a: number[], b: number[], t: number): number[] => {\n  const dotProduct = a.map((_, idx) => a[idx] * b[idx]).reduce((m, n) => m + n)\n  const theta = Math.acos(dotProduct)\n\n  return a.map(\n    (_, idx) =>\n      (Math.sin((1 - t) * theta) / Math.sin(theta)) * a[idx] +\n      (Math.sin(t * theta) / Math.sin(theta)) * b[idx]\n  )\n}\n\n// calculations from: https://easings.net\nconst easeQuad = {\n  in: (x: number): number => x * x,\n  out: (x: number): number => 1 - (1 - x) * (1 - x),\n  inOut: (x: number): number =>\n    x < 0.5 ? 2 * x * x : 1 - Math.pow(-2 * x + 2, 2) / 2,\n}\n\n/** Options for rotating the globe. */\ninterface RotateGlobeOptions {\n  /** The number of seconds per revolution. */\n  secPerRev?: number\n  /** The maximum zoom level for spinning the globe.  */\n  maxSpinZoom?: number\n  /** The zoom level at which the spinning slows down. */\n  slowSpinZoom?: number\n}\n\n/** Options for rotating the viewport. */\ninterface RotateViewportOptions {\n  /** The number of seconds per revolution. */\n  secPerRev?: number\n  /** The pitch angle in degrees. */\n  pitch?: number\n  /** The center of rotation. */\n  around?: LngLatLike\n}\n\n/** Props for the component. */\ntype Props = {\n  /** Whether to rotate the globe. */\n  rotateGlobe?: boolean | RotateGlobeOptions\n  /** Whether to rotate the viewport. */\n  rotateViewport?: boolean | RotateViewportOptions\n  /** Whether to reverse the rotation direction. */\n  reverse?: boolean\n  /** Whether to reset the rotation when stopped. */\n  resetWhenStopped?: boolean\n  /** Translation options. */\n  translate?: {\n    /** The type of translation. */\n    type?: 'line' | 'sphere'\n    /** The starting position. */\n    start: [number, number, number]\n    /** The ending position. */\n    end: [number, number, number]\n    /** The target position. */\n    target: LngLatLike\n    /** The ending target position. */\n    targetEnd?: LngLatLike\n    /** The easing function to use. */\n    easing?: 'in' | 'out' | 'inOut'\n    /** Whether to loop the translation. */\n    loop?: boolean\n    /** The duration of the translation in milliseconds. */\n    duration: number\n  }\n  /** The children to render. */\n  children?: any\n}\n\nexport const Camera: Component<Props> = (props) => {\n  const [ctx] = useMapContext()\n  let animationTime = 0.1\n  let isReverse = false\n\n  // Handle User Interaction\n  const [userInteraction, setUserInteraction] = createSignal(false)\n  ;['mousedown', 'touchstart', 'wheel'].forEach((event) =>\n    ctx.map.on(event, (evt) => !evt.rotate && setUserInteraction(true))\n  )\n  ;['moveend', 'mouseup', 'touchend'].forEach((event) =>\n    ctx.map.on(event, (evt) => !evt.rotate && setUserInteraction(false))\n  )\n\n  const updateCameraPosition = async (\n    [lng, lat, alt]: number[],\n    target: LngLatLike\n  ) => {\n    const camera = ctx.map.getFreeCameraOptions()\n    camera.position = window.MapLib.MercatorCoordinate.fromLngLat(\n      [lng, lat],\n      alt\n    )\n    camera.lookAtPoint(target)\n    ctx.map.setFreeCameraOptions(camera)\n  }\n\n  const frame = () => {\n    props.translate && window.requestAnimationFrame(frame)\n    const params = [\n      props.translate.start,\n      props.translate.end,\n      props.translate.easing\n        ? easeQuad[props.translate.easing](animationTime)\n        : animationTime,\n    ] as const\n    const position =\n      props.translate.type === 'line' ? lerp(...params) : slerp(...params)\n\n    updateCameraPosition(position, props.translate.target)\n\n    if (!props.translate.loop && (animationTime > 1.0 || animationTime < 0.0))\n      isReverse = !isReverse\n    animationTime = isReverse ? animationTime - 0.001 : animationTime + 0.001\n  }\n\n  createEffect(() => {\n    props.translate && window.requestAnimationFrame(frame)\n  })\n\n  const options = { duration: 1000, easing: (n) => n }\n\n  const rotateGlobe = (): void => {\n    if (userInteraction()) return\n    const {\n      secPerRev = 120,\n      maxSpinZoom = 5,\n      slowSpinZoom = 3,\n    }: RotateGlobeOptions = props.rotateGlobe as RotateGlobeOptions\n\n    const zoom: number = ctx.map.getZoom()\n    if (zoom > maxSpinZoom) return\n    let distancePerSecond: number = 360 / secPerRev\n    if (zoom > slowSpinZoom)\n      distancePerSecond *= (maxSpinZoom - zoom) / (maxSpinZoom - slowSpinZoom)\n    const center: mapboxgl.LngLat = ctx.map.getCenter()\n    center.lng = props.reverse\n      ? center.lng + distancePerSecond\n      : center.lng - distancePerSecond\n    ctx.map.easeTo({ center, ...options }, { rotate: true })\n  }\n\n  const rotateViewport = (): void => {\n    if (!props.rotateViewport || userInteraction()) {\n      ctx.map.stop()\n      return\n    }\n    const rotateViewport = props.rotateViewport as RotateViewportOptions\n    const secPerRev = rotateViewport?.secPerRev || 60\n    const bearing = props.reverse\n      ? ctx.map.getBearing() + 360 / secPerRev\n      : ctx.map.getBearing() - 360 / secPerRev\n    const pitch = rotateViewport?.pitch || 60\n    const around = rotateViewport?.around\n    ctx.map.easeTo({ bearing, pitch, around, ...options }, { rotate: true })\n  }\n\n  const onEnd = () => (props.rotateGlobe ? rotateGlobe() : rotateViewport())\n  ctx.map.on('moveend', onEnd).on('dragend', onEnd)\n\n  let originalCenter: mapboxgl.LngLatLike\n  createEffect(() => {\n    if (props.rotateGlobe == undefined) return\n    if (props.rotateGlobe) {\n      originalCenter = ctx.map.getCenter()\n      rotateGlobe()\n    } else {\n      props.resetWhenStopped\n        ? ctx.map.stop().easeTo({ center: originalCenter })\n        : ctx.map.stop()\n    }\n  })\n\n  createEffect(() => {\n    if (props.rotateViewport == undefined) return\n    props.rotateViewport\n      ? rotateViewport()\n      : props.resetWhenStopped\n      ? ctx.map.stop().resetNorthPitch()\n      : ctx.map.stop()\n  })\n\n  onCleanup(() => ctx.map.off('moveend', onEnd).off('dragend', onEnd))\n\n  return props.children\n}\n","import { onCleanup, createEffect, VoidComponent } from 'solid-js'\nimport { useMapContext } from '../MapProvider'\nimport type { Light as LightSpecification } from 'mapbox-gl'\n\ntype Props = {\n  /** Light Specifications */\n  style: LightSpecification\n}\nexport const Light: VoidComponent<Props> = (props: Props) => {\n  const [ctx] = useMapContext()\n\n  // Add or Update Light Layer\n  createEffect(() => ctx.map.setLight(props.style || {}))\n\n  // Remove Light Layer\n  onCleanup(() => ctx.map?.setLight(null))\n\n  return null\n}\n","import { onCleanup, VoidComponent } from 'solid-js'\nimport { useMapContext } from '../MapProvider'\nimport { drawEvents } from '../../events'\nimport type { drawEventTypes } from '../../events'\n\ntype Props = {\n  /** Draw Library */\n  lib: any\n  /** Draw Options */\n  options?: object\n  /** Draw Control Position */\n  position?: 'top-left' | 'top-right' | 'bottom-left' | 'bottom-right'\n  /** Draw Control Instance */\n  getInstance?: (object) => void\n} & drawEventTypes\n\nexport const Draw: VoidComponent<Props> = (props: Props) => {\n  const [ctx] = useMapContext()\n\n  // Add Draw Control\n  const draw = new props.lib(props.options)\n  ctx.map.addControl(draw, props.position || 'top-right')\n  props.getInstance && props.getInstance(draw)\n\n  // Hook up events\n  const eventList: Record<string, (evt: any) => void> = {}\n  drawEvents.forEach(item => {\n    if (props[item]) {\n      const event = `draw.${item.slice(2).toLowerCase()}`\n      const fn = evt => props[item](evt)\n      eventList[event] = fn\n      ctx.map.on(event, fn)\n    }\n  })\n\n  // Remove Draw Control\n  onCleanup(() => {\n    // Remove Events\n    Object.keys(eventList).forEach(event => ctx.map.off(event, eventList[event]))\n    // Remove Control\n    ctx.map?.removeControl(draw)\n  })\n\n  return null\n}\n"],"names":["state","setState","createStore","map","MapContext","createContext","useMapContext","useContext","MapProvider","props","_$createComponent","Provider","value","children","mapEvents","layerEvents","drawEvents","mapBase","gitBase","gishub","hereBase","vectorStyleList","mb","standard","light","dark","street","outdoor","sat","sat_street","nav_base","nav_base_night","nav","nav_night","basic","monochrome","leshine","icecream","cali","northstar","mineral","moonlight","frank","minimo","decimal","stand","blueprint","bubble","pencil","swiss_ski","vintage","whaam","neon","camoflauge","emerald","runner","x_ray","here","base","day","night","esri","charted_territory","colored_pencil","community","mid_century","modern_antique","nat_geo","newspaper","open_street_map","light_gray_canvas","dark_gray_canvas","human_geo_light","human_geo_dark","world_navigation","world_street","world_street_night","world_terrain","world_terrain_hybrid","world_topographic","chromium","dreamcatcher","seahaven","sangria","mercurial","imagery","imagery_hybrid","firefly","firefly_hybrid","oceans","carto","stamen","tf","rasterStyleList","osm","org","human","cycle","topo","_copy","voyager","positron","toner","toner_lite","watercolor","terrain","trans","trans_dark","landscape","outdoors","neighbourhood","spinal","pioneer","atlas","mobile","MapGL","mapRef","resizeObserver","mutationObserver","mapLoaded","setMapLoaded","createSignal","darkMode","setDarkMode","window","matchMedia","matches","document","body","classList","contains","internal","setInternal","debug","text","debugEvents","console","getStyle","style","String","split","reduce","p","c","replace","apikey","env","VITE_VECTOR_API_KEY","onMount","async","mapLib","import","Map","supported","Error","version","accessToken","options","VITE_MAPBOX_ACCESS_TOKEN","interactive","onViewportChange","viewport","projection","container","darkStyle","fitBoundsOptions","padding","sourceIdList","layerIdList","MapLib","forEach","item","prop","event","slice","toLowerCase","on","evt","setTimeout","clickOnLayer","Object","keys","layerId","once","rotate","onUserInteraction","darkTheme","addEventListener","toString","MutationObserver","observe","attributes","disableResize","ResizeObserver","resize","createEffect","key","config","id","setConfigProperty","point","x","originalEvent","y","center","lat","getCenter","lng","zoom","getZoom","pitch","getPitch","bearing","getBearing","inTransit","bounds","vp","cameraForBounds","stop","transitionType","defer","proj","setProjection","cur","cursorStyle","getCanvas","cursor","prev","isStyleLoaded","oldStyle","oldLayers","layers","filter","l","includes","oldSources","sources","s","obj","setStyle","newStyle","insertLayers","list","layer","index","findIndex","i","metadata","smg","beforeType","type","beforeId","fog","onCleanup","disconnect","remove","_el$","_tmpl$","_$use","_$insert","_c$","_$memo","_tmpl$2","_el$3","_tmpl$3","_$effect","_p$","_v$","_v$2","class","_v$3","_v$4","position","inset","e","_$setAttribute","t","_$className","a","_$classList","o","_$style","undefined","SourceContext","useSourceId","Source","ctx","createUniqueId","lookup","url","source","tiles","VITE_RASTER_API_KEY","devicePixelRatio","attribution","addSource","push","getSource","data","isSourceLoaded","setData","coords","coordinates","updateImage","setUrl","setTiles","src","removeLayer","removeSource","baseStyle","layoutStyles","diff","newProps","prevProps","Set","acc","newKey","startsWith","updateStyle","layout","paint","entries","nk","Layer","sourceId","customLayer","addLayer","slot","find","fire","debugEvent","setLayoutProperty","validate","setPaintProperty","minzoom","maxzoom","setLayerZoomRange","setFilter","visible","featureState","removeFeatureState","sourceLayer","setFeatureState","getLayer","Layer3D","worldOriginMercator","MercatorCoordinate","fromLngLat","origin","worldScale","meterInMercatorCoordinateUnits","worldMatrix","BABYLON","THREE","babylon","Matrix","Compose","Vector3","Quaternion","FromEulerAngles","Math","PI","z","translateX","translateY","translateZ","rotateX","rotateY","rotateZ","scale","renderingMode","onAdd","gl","engine","Engine","useHighPrecisionMatrix","this","scene","Scene","autoClear","detachControl","beforeRender","wipeCaches","activeCamera","Camera","defaultLight","HemisphericLight","camera","DirectionalLight","set","normalize","add","renderer","WebGLRenderer","canvas","context","antialias","render","matrix","freezeProjectionMatrix","multiply","FromArray","getFreeCameraOptions","TransformCoordinates","getProjectionMatrix","clone","invert","rotationX","Matrix4","makeRotationAxis","rotationY","rotationZ","m","fromArray","makeTranslation","projectionMatrix","resetState","onRender","triggerRepaint","Atmosphere","setFog","getFog","Terrain","isMapLibre","tileSize","setTerrain","exaggeration","Control","update","create","splitProps","control","setControl","controlClasses","NavigationControl","ScaleControl","AttributionControl","GeolocateControl","FullscreenControl","LogoControl","TerrainControl","untrack","hasControl","removeControl","custom","get","addControl","Marker","lngLat","create_popup","create_marker","marker","popup","LNGLAT","Popup","closeOnClick","focusAfterOpen","onOpen","onClose","setHTML","setDOMContent","setPopup","showPopup","isOpen","togglePopup","onDragStart","onDragEnd","onDrag","getLngLat","toArray","setLngLat","addTo","setDraggable","draggable","trackPointer","MAPLIB","PATTERN","diagonal_l","size","path","diagonal_r","horizontal","vertical","cross","hash","chevron_h","chevron_v","square","fill","hex","circle","patternList","MGL_Image","setSize","width","height","hasImage","removeImage","pattern","ops","pixelRatio","_loadImage","_createPattern","addImage","image","callback","trimStart","DOMParser","parseFromString","childNodes","SVGElement","setAttribute","stroke","XMLSerializer","serializeToString","loadImage","error","imageData","trimEnd","endsWith","fetch","transform","img","Image","crossOrigin","onload","createElement","max","getContext","imageSmoothingEnabled","drawImage","getImageData","Uint8Array","willReadFrequently","fillStyle","background","fillRect","strokeStyle","color","lineWidth","lineWith","Path2D","easeQuad","in","out","inOut","pow","animationTime","isReverse","userInteraction","setUserInteraction","frame","translate","requestAnimationFrame","params","start","end","easing","alt","target","lookAtPoint","setFreeCameraOptions","updateCameraPosition","lerp","b","_","idx","slerp","dotProduct","n","theta","acos","sin","loop","duration","rotateGlobe","secPerRev","maxSpinZoom","slowSpinZoom","distancePerSecond","reverse","easeTo","rotateViewport","around","onEnd","originalCenter","resetWhenStopped","resetNorthPitch","off","Light","setLight","Draw","draw","lib","getInstance","eventList","fn"],"mappings":"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"}